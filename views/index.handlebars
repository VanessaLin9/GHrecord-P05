<div class="banner"></div>
<div class="container">
  <div class="row">
    <div class="col-xl-8 col-md-10 col-12 mx-auto">
      <form action="">
        {{!-- 日期 --}}
        <div class="row mt-5">
          <div class="col-4 d-flex align-items-center">
            <h5>日期</h5>
          </div>
          <div class="col-8">
            <input type="date"  min="2021-01-01"
          max="2028-12-30" name="date" id="date" value={{today}} required>
          </div>
        </div>

        {{!-- 關卡選擇 --}}
        <div class="row mt-5">
          <div class="col-4 d-flex align-items-center">
            <h5>關卡</h5>
          </div>
          <div class="col-8">
            <label for="exampleFormControlSelect1">Example select</label>
            <select class="form-control" id="exampleFormControlSelect1">
              <option>1</option>
              <option>2</option>
              <option>3</option>
              <option>4</option>
              <option>5</option>
            </select>
          </div>
        </div>

        {{!-- 參與者 --}}
        <div class="row mt-5">
          <div class="col-4 d-flex align-items-center">
            <h5>參與者</h5>
          </div>
          <div class="col-8 participant" id="participant">
            {{#each players}}
            <div class="form-check form-check-inline ml-1">
              <input class="form-check-input" type="checkbox" id="inlineCheckbox{{this.id}}" value="{{this.id}}" >
              <label class="form-check-label" for="inlineCheckbox{{this.id}}">{{this.name}}</label>
            </div>
            {{/each}}
          </div>
        </div>

        {{!-- 關主選擇 --}}
        <div class="row mt-5">
          <div class="col-4 d-flex align-items-center">
              <h5>關主選擇</h5>
          </div>

          <div class="col-4">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios1" value="option1" checked>
              <label class="form-check-label" for="exampleRadios1">
                隨機抽籤
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios2" value="option2" disabled>
              <label class="form-check-label" for="exampleRadios2" >
                指定關主
              </label>
            </div>
          </div>

          <div class="col-4 participant">
            <div class="text-center" id="createHostBy">
              <待抽候選關主>
            </div>
            
            <div id="drawHost">
             {{!-- 自動讀取參與者名單 --}}
            </div>
          </div>
        </div>

        <div class="row mt-5" id="showHost">
          {{!-- 顯示關主 --}}
        </div>

        {{!-- 確認按鈕 --}}
        <div class="row mt-5">
          <div class="col-2 mx-auto">
            <div class="btn btn-secondary" id="btn">產生關主</div>
          </div>
          <div class="col-2 ">
            <button class="btn btn-dark disappear" type="submit" id="confirm">確認紀錄</button>
          </div>
        </div>
      
      </form>

      {{!-- 近三期紀錄 --}}
      <table class="table mt-5">
        <thead>
          <tr>
            <th scope="col">日期</th>
            <th scope="col">關卡</th>
            <th scope="col">關主</th>
            <th scope="col">玩家</th>
          </tr>
        </thead>
        <tbody>
          <tr></tr>
        </tbody>
      </table>
    </div>

  </div>
  
</div>

<script>
  const participant = document.getElementById("participant")
  const drawHost = document.getElementById("drawHost")
  const createHostBy = document.getElementById("createHostBy")
  const btn = document.getElementById('btn')
  const showHost = document.getElementById('showHost')
  const confirm = document.getElementById('confirm')
  let drawBox = []


{{!-- 點選參加者 --}}
  participant.addEventListener("click", function check(event) {
    let parent = event.target.parentElement
    let pickBox = parent.firstElementChild
    let pickName = parent.lastElementChild
    let item = parent.cloneNode(true)
    if (event.target.type === 'checkbox') {
      if (parent.firstElementChild.disabled) {
      return
    } else {
      console.log('加人')
      parent.firstElementChild.checked = true
      parent.firstElementChild.disabled = true
      let Id = Number(pickBox.value)
      let name = pickName.innerText
      drawBox.push({id:Id, name:name})
      let firstChild = item.firstElementChild
      firstChild.classList.add('disappear')
      item.classList.remove('form-check-inline')
      let trash = document.createElement('i')
      trash.className="fas fa-minus-circle"
      item.insertBefore(trash, firstChild)
      drawHost.appendChild(item)
    }}
  })

{{!-- 待選Host區塊 --}}
  drawHost.addEventListener("click", function(event) {
    console.log('移除')
    drawHost.removeChild(event.target.parentElement) 
    let removeParticipant = event.target
    console.log('==>', removeParticipant)
    console.log(drawBox)
    console.log(drawBox.indexOf('2'))
  })

{{!-- 按鈕區域 --}}
  btn.addEventListener("click", function check (event) {
    let boxLength = drawBox.length
    let host = Math.floor(Math.random()*boxLength)
    let hostName = drawBox[host].name
    let show = document.createElement('div')
    show.className = "col-12 showHostDiv"
    let rowHTML = ''
    rowHTML+= `
    <h4 class="text-center font-weight-bold">關主: ${drawBox[host].name} </h4>
    `
    show.innerHTML = rowHTML
    showHost.append(show)
    confirm.classList.remove('disappear')
  })
</script>
